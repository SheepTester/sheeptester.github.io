var C=0,x,v;function S(e){if(!v||!x){x=Object.assign(document.createElement("a"),{className:"error-count",href:"#errors"});let o=Object.assign(document.createElement("h2"),{className:"error-count-wrapper"});o.append(x);let t=Object.assign(document.createElement("p"),{className:"error-note",textContent:"It could be due to a bug, or your input is not the correct format. If you'd like to report the error, please send me the entire error log below."});v=Object.assign(document.createElement("pre"),{className:"error-log"});let r=Object.assign(document.createElement("div"),{className:"error-wrapper",id:"errors"});r.append(t,v),document.body.append(o,r)}v.append(e,`
`),C++,x.textContent=`${C} error${C===1?"":"s"} occurred`}window.onerror=(e,o,t,r,n)=>{S(n?.stack&&n.stack.includes(n.name)?`Uncaught ${n.stack}`:`Uncaught ${n?.name??String(n)}: ${e} at ${o}:${t}${r!==void 0?":"+r:""}${n?.stack?`
	`+n.stack.replaceAll(`
`,`
	`):""}`)};window.addEventListener("unhandledrejection",({reason:e})=>{S(e?.stack&&e.stack.includes(e.name)?`Uncaught (in promise) ${e.stack}`:e instanceof Error?`Uncaught (in promise) ${e.constructor.name}: ${e.message}${e?.stack?`
	`+e.stack.replaceAll(`
`,`
	`):""}`:String(e))});function m(e){return e>1e9?`${(e/1e9).toPrecision(3)} GB`:e>1e6?`${(e/1e6).toPrecision(3)} MB`:e>1e3?`${(e/1e3).toPrecision(3)} kB`:e!==1?`${e} bytes`:"1 byte"}function T(e){let o=e.lastIndexOf(".");return o===-1?e:e.slice(0,o)}var V=new TextEncoder;function L(e,o){return e.find(({type:t})=>o.some(r=>t.startsWith(r)))??e[0]}function U(e){return e.kind==="string"?new Promise(o=>e.getAsString(o)):Promise.resolve(e.getAsFile())}function y({fileName:e,input:o,dropTarget:t,pasteTarget:r,pasteButton:n,defaultPreferredTypes:a,onFile:s}){let p=o.accept?o.accept.replaceAll("*","").split(","):a;async function g(i){let l;switch(i.type){case"files":{l=L(Array.from(i.files),p);break}case"data-transfer":{l=await U(L(Array.from(i.transfer.items),p));break}case"clipboard":{let{item:b,type:I}=L(i.items,p),j=await b.getType(I);l=new File([j],I.replaceAll("/","_"),{type:j.type});break}}if(l===null)return;let c=l instanceof File?`${l.name} \xB7 ${m(l.size)}`:`Plain text \xB7 ${m(V.encode(l).length)}`;try{(await s(l)??!0)&&e&&(e.textContent=c,e.classList.remove("file-error"))}catch(b){throw e&&(e.textContent=c+" \u2014 failed to load",e.classList.add("file-error")),b}}if(o.addEventListener("change",()=>{o.files&&o.files.length>0&&g({type:"files",files:o.files}),o.value=""}),o.dataset.default){let i=o.dataset.default,l=i.slice(i.lastIndexOf("/")+1);fetch(i).then(c=>c.blob()).catch(c=>{throw e&&(e.textContent=l+" \u2014 failed to load",e.classList.add("file-error")),c}).then(c=>g({type:"files",files:[new File([c],l,c)]}))}t?.addEventListener("drop",i=>{i.dataTransfer&&i.dataTransfer.items.length>0&&g({type:"data-transfer",transfer:i.dataTransfer}),t.classList.remove("drag-over"),i.preventDefault()}),t?.addEventListener("dragover",i=>{t.classList.add("drag-over"),i.preventDefault()}),t?.addEventListener("dragleave",()=>{t.classList.remove("drag-over")}),r&&document.addEventListener("paste",i=>{(i.target instanceof HTMLTextAreaElement||i.target instanceof HTMLInputElement)&&!i.target.readOnly&&!i.target.disabled||i.clipboardData&&i.clipboardData.items.length>0&&g({type:"data-transfer",transfer:i.clipboardData})});let u=null;n?.addEventListener("click",async()=>{try{n.disabled=!0;let l=(await navigator.clipboard.read()).flatMap(c=>c.types.map(b=>({item:c,type:b})));l.length>0&&g({type:"clipboard",items:l}),u&&clearTimeout(u),n.classList.add("icon-done"),u=setTimeout(()=>{n.classList.remove("icon-done")},1e3)}catch(i){if(i instanceof DOMException&&i.name==="NotAllowedError")console.warn("Failed to read clipboard",i);else throw i}finally{n.disabled=!1}})}function O(e,o){o.dataset.ignore="true";let t=o.closest(".reform\\:io"),r=k(t);y({fileName:o.parentElement?.querySelector(".file-name")??null,input:o,dropTarget:t instanceof HTMLElement?t:null,pasteTarget:o.classList.contains("reform:paste-target"),pasteButton:r,defaultPreferredTypes:[],onFile:async n=>{e.handleValue(n instanceof File?n:new File([n],"text.txt",{type:"text/plain"}))}})}function R(e,o){o.dataset.ignore="true";let t=o.closest(".reform\\:io"),r=k(t),n=t?.querySelector(".input-content canvas");n&&!(n instanceof HTMLCanvasElement)&&(console.warn(n,"is not a <canvas> element"),n=null);let a=n??document.createElement("canvas"),s=a.getContext("2d",{willReadFrequently:!!a.dataset.willReadFrequently});if(!s)throw new TypeError("Failed to get canvas context for the image input preview.");y({fileName:o.parentElement?.querySelector(".file-name")??null,input:o,dropTarget:t instanceof HTMLElement?t:null,pasteTarget:o.classList.contains("reform:paste-target")??!1,pasteButton:r,defaultPreferredTypes:["image/*"],onFile:async p=>{if(typeof p=="string")return!1;let g=URL.createObjectURL(p);try{let u=document.createElement("img");u.src=g,await new Promise((i,l)=>{u.addEventListener("load",i),u.addEventListener("error",()=>l(new TypeError(`Could not load '${p.name}' as image.`)))}),a.dataset.name=T(p.name),a.width=u.width,a.height=u.height,s.drawImage(u,0,0),e.handleValue(s)}finally{URL.revokeObjectURL(g)}}})}function F(e,o){o.dataset.ignore="true";let t=o.closest(".reform\\:io"),r=k(t),n=t?.querySelector(".input-content video");n&&!(n instanceof HTMLVideoElement)&&(console.warn(n,"is not a <video> element"),n=null);let a=n??document.createElement("video"),s;y({fileName:o.parentElement?.querySelector(".file-name")??null,input:o,dropTarget:t instanceof HTMLElement?t:null,pasteTarget:o.classList.contains("reform:paste-target"),pasteButton:r,defaultPreferredTypes:["video/*"],onFile:async p=>{if(typeof p=="string")return!1;s&&URL.revokeObjectURL(s),s=URL.createObjectURL(p),a.src=s,a.dataset.name=T(p.name),await new Promise((g,u)=>{a.onloadeddata=()=>{a.readyState<2||g()},a.onerror=()=>u(new TypeError(`Could not load '${p.name}' as video.`))}),e.handleValue(a)}})}function N(e,o){let t=o.closest(".reform\\:io"),r=k(t);o.dataset.ignore="true";let n=t?.querySelector(".input-controls"),a=t?.querySelector(".input-content");y({fileName:o.parentElement?.querySelector(".file-name")??null,input:o,dropTarget:n instanceof HTMLElement?n:null,pasteTarget:o.classList.contains("reform:paste-target"),pasteButton:r,defaultPreferredTypes:["text/plain"],onFile:async s=>{let p=s instanceof File?await s.text():s;a instanceof HTMLTextAreaElement&&(a.value=p),e.handleValue(p)}})}function k(e){let o=e?.querySelector(".input-controls");if(o instanceof HTMLLabelElement){let t=document.createElement("div");t.classList.add("input-controls"),o.classList.remove("input-controls"),o.replaceWith(t),t.append(o),o=t}if(o&&!e?.querySelector(".reform\\:paste")){let t=document.createElement("button");return t.type="button",t.classList.add("icon","icon-paste","reform:paste"),t.ariaLabel="Paste from clipboard",t.title="Paste from clipboard",o.append(t),t}return null}var D=Symbol("no blob error"),E=class e{#e=null;#o=null;#i=null;#t=null;#l;#r=null;#n=!1;#s=null;#d=null;constructor(o){this.#l=o;let{copyButton:t,shareButton:r}=o;t&&(t.disabled=!0),r&&(r.disabled=!0),t?.addEventListener("click",async()=>{try{t.disabled=!0,this.#i??=this.#a(!0);let n=this.#e?.clipboardTypeHint??this.#e?.downloadTypeHint??(this.#e?.value?this.#e.value instanceof CanvasRenderingContext2D?"image/png":this.#e.value.type:null);if(!n)throw new TypeError("Unable to determine MIME type of clipboard blob. Did you set `clipboardTypeHint`?");try{await navigator.clipboard.write([new ClipboardItem({[n]:this.#i.then(a=>a||Promise.reject(D))})])}catch(a){if(a===D)return;throw a}this.#s&&clearTimeout(this.#s),t.classList.add("icon-done"),this.#s=setTimeout(()=>{t.classList.remove("icon-done")},1e3)}finally{t.disabled=!1}}),r?.addEventListener("click",async()=>{try{r.disabled=!0,this.#o??=this.#a();let n=await this.#o;if(!n)return;await navigator.share({files:[new File([n],this.#e?.fileName??"",{type:n.type})]}),this.#d&&clearTimeout(this.#d),r.classList.add("icon-done"),this.#d=setTimeout(()=>{r.classList.remove("icon-done")},1e3)}catch(n){if(n instanceof DOMException&&n.name==="AbortError")console.warn("Share cancelled",n);else throw n}finally{r.disabled=!1}}),"share"in navigator||r?.remove()}async#a(o=!1){if(o)return this.#e?.provideClipboard?this.#e.provideClipboard():(this.#o??=this.#a(),this.#o);if(!this.#e)return null;if(this.#e.value instanceof Blob)return this.#e.value;if(this.#e.value instanceof CanvasRenderingContext2D){let{canvas:r}=this.#e.value;return new Promise((n,a)=>{r.toBlob(s=>{if(!s){a(new Error("canvas.toBlob returned null"));return}this.#e&&this.#c(s),n(s)})})}if(!this.#e.provideDownload)return null;let t=await this.#e.provideDownload();return this.#c(t),t}#c(o){let t=this.#n?this.#r?.fileName:this.#l.fileName;if(this.#e&&t){let r=this.#e.fileName??"";o&&(r&&(r+=" \xB7 "),r+=m(o.size)),t.textContent=r}}handleOutput(o){this.#e=o instanceof File?f.from(o.name,o):o,this.#o=null,this.#i=null,this.#t&&URL.revokeObjectURL(this.#t),this.#t=null;let{copyButton:t,shareButton:r,downloadLink:n}=this.#l;t&&(t.disabled=!1),r&&(r.disabled=!1),n&&(n.download=this.#e.fileName??"",this.#e.value instanceof Blob?(this.#t=URL.createObjectURL(this.#e.value),n.href=this.#t,this.#n&&(this.#r?.button.replaceWith(n),this.#n=!1)):(this.#r??=z(n,async a=>{try{if(a.disabled=!0,!this.#t){this.#o??=this.#a();let s=await this.#o;if(!s)return;this.#t=URL.createObjectURL(s),n.href=this.#t}document.body.append(n),n.click(),n.remove()}finally{a.disabled=!1}}),this.#n||(n.replaceWith(this.#r.button),this.#n=!0))),this.#c(this.#e.value instanceof Blob?this.#e.value:null)}static fromWrapper(o){let t=o?.querySelector(".download")??null;t&&!(t instanceof HTMLAnchorElement)&&(console.warn(t,"download link is not an <a> element"),t=null);let r=o?.querySelector("button.icon-copy, .reform\\:copy")??null;r&&!(r instanceof HTMLButtonElement)&&(console.warn(r,"copy button is not a <button> element"),r=null);let n=o?.querySelector("button.icon-share")??null;return n&&!(n instanceof HTMLButtonElement)&&(console.warn(n,"copy button is not a <button> element"),n=null),new e({fileName:o?.querySelector(".file-name")??null,downloadLink:t,copyButton:r,shareButton:n})}};function z(e,o){let t=document.createElement("button");t.className=e.className;for(let r of e.childNodes)t.append(r.cloneNode(!0));return t.addEventListener("click",()=>o(t)),{button:t,fileName:t.querySelector(".file-name")}}var f=class{fileName;value;downloadTypeHint;clipboardTypeHint;static from(o,t,r="text/plain"){return new B(o,t instanceof Blob||t instanceof CanvasRenderingContext2D?t:new Blob([t],{type:r}))}},B=class extends f{constructor(o,t){super(),this.fileName=o,this.value=t}};var h=class{lastValue;dependents=[];handleValue(o){this.lastValue=o;for(let t of this.dependents)t(o)}};var d={};function H(e){if(!(e instanceof HTMLElement&&e.dataset.ignore))if(e instanceof HTMLInputElement)if(d[e.name]??=new h,e.type==="number"||e.type==="range"||e.inputMode==="numeric"){if(e.value==="")return;d[e.name].handleValue(+e.value);let o=e.closest(".range-wrapper");if(o){let t=e;if(e.type==="range"){let n=o.lastElementChild;n instanceof HTMLInputElement&&(n.value=e.step==="any"||e.step&&+e.step<.1?(+e.value).toFixed(2):e.value)}else{let n=o.querySelector('[type="range"]');if(n instanceof HTMLInputElement)t=n;else return;t.value=e.value}let r=(+e.value-+t.min)/(+t.max-+t.min);t.style.setProperty("--progress",`${r*100}%`)}}else e.type==="checkbox"?d[e.name].handleValue(e.checked):e.type==="file"?e.files&&e.files.length>0&&d[e.name].handleValue(Array.from(e.files)):e.type==="radio"?e.checked&&d[e.name].handleValue(e.value):d[e.name].handleValue(e.value);else(e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&(d[e.name]??=new h,d[e.name].handleValue(e.value))}for(let e of document.getElementsByClassName("reform:image-input"))e instanceof HTMLInputElement&&(d[e.name]??=new h,R(d[e.name],e));for(let e of document.getElementsByClassName("reform:video-input"))e instanceof HTMLInputElement&&(d[e.name]??=new h,F(d[e.name],e));for(let e of document.getElementsByClassName("reform:text-input"))e instanceof HTMLInputElement&&(d[e.name]??=new h,N(d[e.name],e));for(let e of document.getElementsByClassName("reform:file-input"))e instanceof HTMLInputElement&&(d[e.name]??=new h,O(d[e.name],e));for(let e of document.forms)for(let o of e.elements)H(o);document.addEventListener("input",e=>H(e.target));document.addEventListener("change",e=>H(e.target));var M={};function P(e){let o=typeof e=="string"?e:e.name;if(!M[o]){let t=document.getElementById(o);if(!t){let a=document.getElementsByName(o);a.length>1&&console.warn("More than one element with name",o,Array.from(a)),t=a[0]??null}let r=t instanceof HTMLCanvasElement?t.getContext("2d"):t,n=typeof e!="string"&&e.deps||t?.dataset.deps?.split(" ")||[];M[o]={name:o,element:t,object:r,deps:n.map(a=>a.startsWith("&")?{name:a.slice(1),reference:!0}:{name:a,reference:!1})}}return M[o]}function te(e,o){let{name:t,element:r,object:n,deps:a}=P(e);d[t]??=new h;let s={callback:l=>{d[t].handleValue(l)}},p=r?.closest(".reform\\:io")?.querySelector(".output-controls");if(p){let l=E.fromWrapper(p);d[t].dependents.push(c=>{(c instanceof File||c instanceof f)&&l.handleOutput(c)})}let g=0,u=async()=>{if(i.size===a.length){let l=++g,c=await o(n,s);if(l!==g)return;c!==void 0&&d[t].handleValue(c)}},i=new Set;for(let{name:l,reference:c}of a)if(c){let{object:b}=P(l);s[l]=b,i.add(l)}else d[l]??=new h,d[l].lastValue!==void 0&&(s[l]=d[l].lastValue,i.add(l)),d[l].dependents.push(b=>{s[l]=b,i.add(l),u()});u()}export{f as Out,te as on};
//# sourceMappingURL=index.js.map
